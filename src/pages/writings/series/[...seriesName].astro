---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const allWritings = await getCollection('writings');
  const seriesMap = new Map<string, typeof allWritings>();
  
  allWritings.forEach((writing) => {
    if (writing.data.series) {
      if (!seriesMap.has(writing.data.series)) {
        seriesMap.set(writing.data.series, []);
      }
      seriesMap.get(writing.data.series)!.push(writing);
    }
  });

  return Array.from(seriesMap.entries()).map(([seriesName, writings]) => ({
    params: { seriesName },
    props: { 
      seriesName,
      writings: writings.sort((a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime()),
    },
  }));
}

const { seriesName, writings } = Astro.props;
---

<BaseLayout
  title={`${seriesName} — Series`}
  description={`A series of writings on ${seriesName}`}
>
  <div class="container mx-auto px-6">
    <header class="mb-section animate-fade-in-up">
      <nav class="mb-6">
        <a
          href="/writings"
          class="text-sm font-mono text-gray-600 hover:text-gray-900 transition-colors focus:outline-none focus:ring-2 focus:ring-gray-900 focus:ring-offset-2 rounded"
        >
          ← Back to Writings
        </a>
      </nav>
      <h1 class="text-hero font-bold mb-4 tracking-tight">
        {seriesName}
      </h1>
      <p class="text-lg text-gray-700 max-w-2xl">
        A series of {writings.length} {writings.length === 1 ? 'article' : 'articles'} exploring this theme (so far).
      </p>
    </header>

    <ul class="space-y-6">
      {writings.map((writing, index) => (
        <li 
          class="animate-fade-in-up"
          style={`animation-delay: ${0.1 + index * 0.05}s;`}
        >
          <article class="border-b border-gray-200 pb-8 last:border-b-0">
            <a
              href={`/writings/${writing.slug}`}
              class="group block focus:outline-none focus:ring-2 focus:ring-gray-900 focus:ring-offset-2 rounded"
            >
              <header class="mb-4">
                <h2 class="text-2xl font-semibold mb-2 group-hover:text-gray-600 transition-colors">
                  {writing.data.title}
                </h2>
                <div class="flex items-center gap-4 flex-wrap text-sm font-mono text-gray-600">
                  <time datetime={writing.data.pubDate.toISOString()}>
                    {writing.data.pubDate.toLocaleDateString('en-US', {
                      year: 'numeric',
                      month: 'long',
                      day: 'numeric',
                    })}
                  </time>
                  <span class="px-2 py-1 bg-gray-100 rounded">
                    {writing.data.status}
                  </span>
                  {writing.data.tags.length > 0 && (
                    <div class="flex items-center gap-2 flex-wrap">
                      {writing.data.tags.map((tag) => (
                        <span class="px-2 py-1 bg-gray-100 rounded text-xs">
                          {tag}
                        </span>
                      ))}
                    </div>
                  )}
                </div>
              </header>
              
              <p class="text-gray-600">
                {writing.data.description}
              </p>
            </a>
          </article>
        </li>
      ))}
    </ul>
  </div>
</BaseLayout>
